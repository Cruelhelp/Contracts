<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoatMouth Equity Allocation Agreement</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.2.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            max-width: 900px;
            margin: 100px auto;
            padding: 0 80px;
            background: #ffffff;
            color: #1a1a1a;
            line-height: 1.9;
            letter-spacing: 0.2px;
        }
        .letterhead {
            text-align: center;
            margin-bottom: 120px;
        }
        .logo {
            height: 240px;
            margin-bottom: 20px;
        }
        .company-type {
            font-size: 20px;
            color: #555555;
            margin: 0;
            font-weight: 400;
        }
        h1 {
            font-family: 'Roboto Slab', serif;
            font-size: 36px;
            font-weight: 700;
            text-align: left;
            margin: 0 0 60px 0;
            color: #000000;
        }
        h2 {
            font-family: 'Roboto Slab', serif;
            font-size: 20px;
            font-weight: 600;
            color: #000000;
            margin: 60px 0 20px 0;
        }
        p {
            font-size: 17px;
            margin: 16px 0;
        }
        strong {
            font-weight: 600;
            color: #000000;
        }
        ul, ol {
            padding-left: 30px;
            margin: 16px 0;
        }
        li {
            margin-bottom: 10px;
            font-size: 17px;
        }
        .note {
            background: #f8f9fa;
            padding: 25px;
            margin: 60px 0;
            font-size: 15px;
            font-style: italic;
            color: #444444;
            border-left: 4px solid #cccccc;
            border-radius: 4px;
        }
        .signature-section {
            margin: 100px 0 60px 0;
        }
        .sig-box {
            margin-bottom: 80px;
        }
        .sig-header {
            font-family: 'Roboto Slab', serif;
            font-size: 19px;
            font-weight: 500;
            color: #000000;
            margin-bottom: 12px;
        }
        .signed-preview {
            margin-top: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
            display: none;
        }
        .signed-preview img {
            max-height: 100px;
            border-bottom: 1px solid #000;
            margin-bottom: 10px;
        }
        .signed-info {
            font-size: 15px;
            color: #555;
        }
        .signed-info strong {
            color: #000;
        }
        .name-input {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            border: 1px solid #dddddd;
            border-radius: 8px;
            margin-bottom: 20px;
            box-sizing: border-box;
            background: #ffffff;
        }
        .canvas-wrapper {
            width: 100%;
            height: 200px;
            border: 2px solid #000000;
            border-radius: 8px;
            background: #ffffff;
            overflow: hidden;
            margin-bottom: 20px;
        }
        canvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        .sig-actions {
            text-align: right;
        }
        .sig-actions button {
            padding: 12px 24px;
            margin-left: 16px;
            font-size: 15px;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .sig-actions button.save-sig {
            background: #000000;
            color: white;
        }
        .sig-actions button.clear {
            background: #eeeeee;
            color: #000000;
        }
        .status-note {
            font-size: 15px;
            font-weight: 500;
            margin-top: 12px;
            text-align: right;
        }
        .status-note.success {
            color: #000000;
        }
        .status-note.error {
            color: #d32f2f;
        }
        #download-btn {
            display: block;
            width: 400px;
            margin: 100px auto 60px;
            padding: 20px;
            font-size: 20px;
            font-weight: 500;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        #download-btn:hover {
            background: #222222;
        }
        .instructions {
            text-align: center;
            font-size: 15px;
            color: #777777;
            margin-top: 80px;
            line-height: 1.7;
        }
    </style>
</head>
<body>

    <div class="letterhead">
        <img src="mainlogo.png" alt="GoatMouth Logo" class="logo">
        <p class="company-type">Limited Liability Company</p>
    </div>

    <h1>Equity Allocation Agreement</h1>

    <h2>Parties</h2>
    <p>The following individuals (collectively, the “Parties”) agree to the equity allocation described below:</p>
    <ul>
        <li><strong>Founder:</strong> Ruel McNeil, hereinafter referred to as the "Founder"</li>
        <li><strong>Team Member 1:</strong> Ineiko McBean, hereinafter referred to as "Team Member 1"</li>
        <li><strong>Team Member 2:</strong> Shaquille Simpson, hereinafter referred to as "Team Member 2"</li>
        <li><strong>Team Member 3:</strong> Darren Downer, hereinafter referred to as "Team Member 3"</li>
    </ul>

    <h2>Equity Arrangement</h2>
    <p>The Parties agree to the following allocation of membership interests in GoatMouth:</p>
    <ol>
        <li>The Founder shall retain <strong>50%</strong> of the Company’s membership interests.</li>
        <li>Each of the three Team Members shall initially receive <strong>10%</strong> of the Company’s membership interests upon making their first significant contribution (such as completing an initial task, delivering code, making a financial investment, or another agreed-upon milestone).</li>
        <li>The remaining <strong>20%</strong> shall form a contribution pool and be allocated over time based on further contributions, including but not limited to financial investments, development work, business development, marketing, or other significant efforts. Allocations from this pool will be determined by mutual agreement of the Parties holding majority interests at the time, with a focus on fairness and value contributed.</li>
    </ol>
    <p>This structure ensures that every participant is rewarded in proportion to the time and value they contribute to the Company.</p>

    <h2>Additional Terms</h2>
    <ul>
        <li>All membership interests remain subject to the future LLC Operating Agreement and any vesting schedules to be established.</li>
        <li>This document is a preliminary agreement on equity distribution and will be superseded by formal legal documentation prepared by a qualified attorney.</li>
        <li>The Parties commit to acting in good faith and collaborating toward the success of the Company.</li>
    </ul>

    <div class="note">
        <strong>Important:</strong> This document does not constitute formal legal advice. The Parties are strongly encouraged to consult a qualified attorney to prepare binding legal documents (including the LLC Operating Agreement) appropriate to their jurisdiction.
    </div>

    <div class="signature-section">
        <h2>Signatures</h2>
        <p>By providing their name and signature below, each Party confirms their understanding and acceptance of the terms above.</p>

        <!-- Founder -->
        <div class="sig-box">
            <div class="sig-header">Founder – Ruel McNeil</div>
            <input type="text" class="name-input" id="name-founder" placeholder="Type full name">
            <div class="canvas-wrapper"><canvas id="canvas-founder"></canvas></div>
            <div class="sig-actions">
                <button class="save-sig" onclick="saveSignature('founder')">Save Signature</button>
                <button class="clear" onclick="clearSignature('founder')">Clear</button>
            </div>
            <div class="status-note" id="status-founder"></div>

            <div class="signed-preview" id="preview-founder">
                <img id="preview-img-founder" alt="Signature preview">
                <div class="signed-info">
                    Signed by: <strong id="preview-name-founder"></strong><br>
                    Date: <strong id="preview-date-founder"></strong>
                </div>
            </div>
        </div>

        <!-- Team Member 1 -->
        <div class="sig-box">
            <div class="sig-header">Team Member 1 – Ineiko McBean</div>
            <input type="text" class="name-input" id="name-tm1" placeholder="Type full name">
            <div class="canvas-wrapper"><canvas id="canvas-tm1"></canvas></div>
            <div class="sig-actions">
                <button class="save-sig" onclick="saveSignature('tm1')">Save Signature</button>
                <button class="clear" onclick="clearSignature('tm1')">Clear</button>
            </div>
            <div class="status-note" id="status-tm1"></div>

            <div class="signed-preview" id="preview-tm1">
                <img id="preview-img-tm1" alt="Signature preview">
                <div class="signed-info">
                    Signed by: <strong id="preview-name-tm1"></strong><br>
                    Date: <strong id="preview-date-tm1"></strong>
                </div>
            </div>
        </div>

        <!-- Team Member 2 -->
        <div class="sig-box">
            <div class="sig-header">Team Member 2 – Shaquille Simpson</div>
            <input type="text" class="name-input" id="name-tm2" placeholder="Type full name">
            <div class="canvas-wrapper"><canvas id="canvas-tm2"></canvas></div>
            <div class="sig-actions">
                <button class="save-sig" onclick="saveSignature('tm2')">Save Signature</button>
                <button class="clear" onclick="clearSignature('tm2')">Clear</button>
            </div>
            <div class="status-note" id="status-tm2"></div>

            <div class="signed-preview" id="preview-tm2">
                <img id="preview-img-tm2" alt="Signature preview">
                <div class="signed-info">
                    Signed by: <strong id="preview-name-tm2"></strong><br>
                    Date: <strong id="preview-date-tm2"></strong>
                </div>
            </div>
        </div>

        <!-- Team Member 3 -->
        <div class="sig-box">
            <div class="sig-header">Team Member 3 – Darren Downer</div>
            <input type="text" class="name-input" id="name-tm3" placeholder="Type full name">
            <div class="canvas-wrapper"><canvas id="canvas-tm3"></canvas></div>
            <div class="sig-actions">
                <button class="save-sig" onclick="saveSignature('tm3')">Save Signature</button>
                <button class="clear" onclick="clearSignature('tm3')">Clear</button>
            </div>
            <div class="status-note" id="status-tm3"></div>

            <div class="signed-preview" id="preview-tm3">
                <img id="preview-img-tm3" alt="Signature preview">
                <div class="signed-info">
                    Signed by: <strong id="preview-name-tm3"></strong><br>
                    Date: <strong id="preview-date-tm3"></strong>
                </div>
            </div>
        </div>
    </div>

    <button id="download-btn" onclick="downloadPDF()">Download Signed Agreement as PDF</button>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://hvdivdqxsdhabeurwkfb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2ZGl2ZHF4c2RoYWJldXJ3a2ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1NDkwNDIsImV4cCI6MjA4MTEyNTA0Mn0.h6WOImT19AyGZIrqeRZ1axkPJhftlZtW6HNKD5gRebI';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const { jsPDF } = window.jspdf;
        const pads = {};
        const roles = ['founder', 'tm1', 'tm2', 'tm3'];

        // Format date nicely
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true });
        }

        roles.forEach(async (role) => {
            const canvas = document.getElementById(`canvas-${role}`);
            pads[role] = new SignaturePad(canvas, { backgroundColor: 'rgb(255,255,255)', penColor: 'rgb(0, 0, 0)' });

            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext('2d').scale(ratio, ratio);
                pads[role].clear();
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Load existing signature from Supabase
            const { data, error } = await supabase
                .from('signatures')
                .select('name, signature_data, signed_at')
                .eq('role', role)
                .single();

            if (data) {
                document.getElementById(`name-${role}`).value = data.name;
                pads[role].fromDataURL(data.signature_data);

                // Show preview
                document.getElementById(`preview-img-${role}`).src = data.signature_data;
                document.getElementById(`preview-name-${role}`).textContent = data.name;
                document.getElementById(`preview-date-${role}`).textContent = formatDate(new Date(data.signed_at));
                document.getElementById(`preview-${role}`).style.display = 'block';

                // Hide input/canvas
                document.querySelector(`#name-${role}`).style.display = 'none';
                document.querySelector(`#canvas-${role}`).parentElement.style.display = 'none';
                document.querySelector(`#canvas-${role}`).closest('.sig-actions').previousElementSibling.style.display = 'none'; // actions
                document.getElementById(`status-${role}`).textContent = '✓ Already signed';
                document.getElementById(`status-${role}`).className = 'status-note success';
            } else if (error && error.code !== 'PGRST116') {
                document.getElementById(`status-${role}`).textContent = 'Error loading signature';
                document.getElementById(`status-${role}`).className = 'status-note error';
            }
        });

        async function saveSignature(role) {
            const nameInput = document.getElementById(`name-${role}`).value.trim();
            const statusEl = document.getElementById(`status-${role}`);

            statusEl.textContent = '';
            statusEl.className = 'status-note';

            if (!nameInput) return alert("Please type your full name.");
            if (pads[role].isEmpty()) return alert("Please draw your signature.");

            const signatureData = pads[role].toDataURL();
            const now = new Date().toISOString();

            const { error } = await supabase
                .from('signatures')
                .upsert({ 
                    role, 
                    name: nameInput, 
                    signature_data: signatureData,
                    signed_at: now 
                }, { onConflict: 'role' });

            if (error) {
                statusEl.textContent = "Save failed: " + error.message;
                statusEl.className += ' error';
            } else {
                // Show preview immediately
                document.getElementById(`preview-img-${role}`).src = signatureData;
                document.getElementById(`preview-name-${role}`).textContent = nameInput;
                document.getElementById(`preview-date-${role}`).textContent = formatDate(new Date());
                document.getElementById(`preview-${role}`).style.display = 'block';

                // Hide signing fields
                document.getElementById(`name-${role}`).style.display = 'none';
                document.getElementById(`canvas-${role}`).parentElement.style.display = 'none';
                document.querySelector(`#canvas-${role}`).closest('.sig-actions').style.display = 'none';

                statusEl.textContent = '✓ Signed and saved successfully!';
                statusEl.className += ' success';
            }
        }

        function clearSignature(role) {
            pads[role].clear();
            document.getElementById(`status-${role}`).textContent = '';
        }

        async function downloadPDF() {
            const btn = document.getElementById('download-btn');
            btn.disabled = true;
            btn.textContent = "Generating PDF...";

            const canvas = await html2canvas(document.body, { scale: 2, useCORS: true });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: [canvas.width, canvas.height] });
            pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
            pdf.save('GoatMouth_Equity_Allocation_Agreement_Signed.pdf');

            btn.disabled = false;
            btn.textContent = "Download Signed Agreement as PDF";
        }
    </script>

    <p class="instructions">
        Instructions:<br>
        • Type your full name and draw your signature<br>
        • Click “Save Signature” – your signature will be timestamped and stored<br>
        • Once saved, everyone will see your signed preview (on any device)<br>
        • When all four have signed → Download the final PDF
    </p>

</body>
</html>
